<?xml version="1.0"?>

<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<!DOCTYPE project PUBLIC "-//PHING GRAMMAR V0.1" "http://ondrejd.info/phing-grammar">

<!-- [[%tabstop:ProjectDescription]] -->

<project name="[[%tabstop:ProjectName]]" basedir="." default="build">
	<property name="version" value="[[%tabstop:1.0]]" />
	
	<property name="builddir" value="${project.basedir}/build"/>
	<property name="srcdir" value="${project.basedir}/src"/>

	<target name="prepare">
		<delete dir="${builddir}"/>
		<mkdir dir="${builddir}"/>
	</target>

	<target name="copy-content" depends="prepare">
		<copy todir="${builddir}">
			<fileset dir="${project.basedir}/src">
				<include name="content/*" />
			</fileset>
		</copy>
	</target>

	<target name="create-jar" depends="copy-content">
		<zip destfile="${builddir}/${project.name}.jar">
			<fileset dir="${builddir}">
				<include name="**/**" />
			</fileset>
		</zip>
	</target>

	<target name="delete-content" depends="create-jar">
		<delete dir="${builddir}/content" />
	</target>

	<target name="prep-xpi">
		<copy todir="${builddir}">
			<fileset dir="${project.basedir}/src">
				<include name="install.rdf" />
				<include name="chrome.manifest" />
			</fileset>
		</copy>
	</target>

	<target name="build">
		<phingcall target="prepare" />
		<phingcall target="copy-content" />
		<phingcall target="create-jar" />
		<phingcall target="delete-content" />
		<phingcall target="prep-xpi" />
		<zip destfile="${project.basedir}/${project.name}-${version}.xpi">
			<fileset dir="${builddir}">
				<include name="**/**" />
			</fileset>
		</zip>
		<delete file="${project.basedir}/${project.name}.jar" />
	</target>
</project>
